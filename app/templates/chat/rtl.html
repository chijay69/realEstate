<!doctype html>
<html lang="en" dir="rtl" xmlns="http://www.w3.org/1999/html">

    <head>
        
        <meta charset="utf-8" />
        <title>Chat | Chatvia - Responsive Bootstrap 4 Chat App</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Responsive Bootstrap 4 Chat App" name="description" />
        <meta content="Themesbrand" name="author" />
        <!-- App favicon -->
        <link rel="shortcut icon" href="{{ url_for('static', filename='chat/assets/images/favicon.ico') }}">

        <!-- magnific-popup css -->
        <link href="{{ url_for('static', filename='chat/assets/libs/magnific-popup/magnific-popup.css') }}" rel="stylesheet" type="text/css" />

        <!-- owl.carousel css -->
        <link rel="stylesheet" href="{{ url_for('static', filename='chat/assets/libs/owl.carousel/assets/owl.carousel.min.css') }}">

        <link rel="stylesheet" href="{{ url_for('static', filename='chat/assets/libs/owl.carousel/assets/owl.theme.default.min.css') }}">

        <!-- Bootstrap Css -->
        <link href="{{ url_for('static', filename='chat/assets/css/bootstrap-rtl.min.css') }}" id="bootstrap-style" rel="stylesheet" type="text/css" />
        <!-- Icons Css -->
        <link href="{{ url_for('static', filename='chat/assets/css/icons.min.css') }}" rel="stylesheet" type="text/css" />
        <!-- App Css-->
        <link href="{{ url_for('static', filename='chat/assets/css/app-rtl.min.css') }}" id="app-style" rel="stylesheet" type="text/css" />
        <!--socketIO-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.3/socket.io.js" integrity="sha512-iWPnCISAd/J+ZacwV2mbNLCaPGRrRo5OS81lKTVPtRg1wGTC20Cfmp5Us5RcbLv42QLdbAWl0MI57yox5VecQg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    </head>

    <body>

        <div class="layout-wrapper d-lg-flex">
            <!-- start side chat user-->
            <div id="sidepiece">
                <img id="img1" src="{{ userId }}" style="display:none"/>
                <!-- start chat conversation -->
                <div class="chat-conversation p-3 p-lg-4" data-simplebar="init">
                    <ul class="list-unstyled mb-0">
                        <li>
                            <div class="conversation-list">
                                <div class="chat-avatar">
                                    <img src="{{ url_for('static', filename='chat/assets/images/users/avatar-4.jpg') }}" alt="">
                                </div>

                                <div class="user-chat-content">
                                    <div class="ctext-wrap">
                                        <div class="ctext-wrap-content">
                                            <p class="mb-0">
                                                Good morning
                                            </p>
                                            <p class="chat-time mb-0"><i class="ri-time-line align-middle"></i> <span class="align-middle">10:00</span></p>
                                        </div>
                                        <div class="dropdown align-self-start">
                                            <a class="dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <i class="ri-more-2-fill"></i>
                                            </a>
                                            <div class="dropdown-menu">
                                                <a class="dropdown-item" href="#">Copy <i class="ri-file-copy-line float-end text-muted"></i></a>
                                                <a class="dropdown-item" href="#">Save <i class="ri-save-line float-end text-muted"></i></a>
                                                <a class="dropdown-item" href="#">Forward <i class="ri-chat-forward-line float-end text-muted"></i></a>
                                                <a class="dropdown-item" href="#">Delete <i class="ri-delete-bin-line float-end text-muted"></i></a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="conversation-name">Doris Brown</div>
                                </div>
                            </div>
                        </li>

                        <li>
                            <div class="chat-day-title">
                                <span class="title">Today</span>
                            </div>
                        </li>
                        {% for msg in msgs %}
                        {% if msg.user_id == userId %}
                        <li>
                            <div class="conversation-list">
                                <div class="chat-avatar">
                                    <img src="{{ url_for('static', filename='chat/assets/images/users/avatar-4.jpg') }}" alt="">
                                </div>

                                <div class="user-chat-content">

                                    <div class="ctext-wrap">
                                        <div class="ctext-wrap-content">
                                            <p class="mb-0">
                                                {{ msg.message }}
                                            </p>
                                            <p class="chat-time mb-0"><i class="ri-time-line align-middle"></i> <span class="align-middle">{{ msg.join_time }}</span></p>
                                        </div>
                                        <div class="dropdown align-self-start">
                                            <a class="dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <i class="ri-more-2-fill"></i>
                                            </a>
                                            <div class="dropdown-menu">
                                                <a class="dropdown-item" href="#">Copy <i class="ri-file-copy-line float-end text-muted"></i></a>
                                                <a class="dropdown-item" href="#">Save <i class="ri-save-line float-end text-muted"></i></a>
                                                <a class="dropdown-item" href="#">Forward <i class="ri-chat-forward-line float-end text-muted"></i></a>
                                                <a class="dropdown-item" href="#">Delete <i class="ri-delete-bin-line float-end text-muted"></i></a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="conversation-name myId">{{ current_user.first_name }}</div>
                                </div>

                            </div>
                        </li>
                        {% else %}
                        <li class="right">
                            <div class="conversation-list">
                                <div class="chat-avatar">
                                    <img src="{{ url_for('static', filename='chat/assets/images/users/avatar-1.jpg') }}" alt="">
                                </div>

                                <div class="user-chat-content">
                                    <div class="ctext-wrap">
                                        <div class="ctext-wrap-content">
                                            <p class="mb-0">
                                                {{ msg.message }}
                                            </p>
                                            <p class="chat-time mb-0"><i class="ri-time-line align-middle"></i> <span class="align-middle">{{ msg.join_time }}</span></p>
                                        </div>

                                        <div class="dropdown align-self-start">
                                            <a class="dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <i class="ri-more-2-fill"></i>
                                            </a>
                                            <div class="dropdown-menu">
                                                <a class="dropdown-item" href="#">Copy <i class="ri-file-copy-line float-end text-muted"></i></a>
                                                <a class="dropdown-item" href="#">Save <i class="ri-save-line float-end text-muted"></i></a>
                                                <a class="dropdown-item" href="#">Forward <i class="ri-chat-forward-line float-end text-muted"></i></a>
                                                <a class="dropdown-item" href="#">Delete <i class="ri-delete-bin-line float-end text-muted"></i></a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="conversation-name"></div>

                                </div>
                            </div>
                        </li>
                        {% endif %}
                        {% endfor %}

                        <li id="messages"></li>
                    </ul>

                </div>
                <!-- end chat conversation end -->
                <!-- start chat input section -->
                <div class="chat-input-section p-3 p-lg-4 border-top mb-0">
                    <div class="row g-0">
                        <div class="col">
                            <input type="text" id="message" class="form-control form-control-lg bg-light border-light" placeholder="Enter Message...">
                        </div>
                        <div class="col-auto">
                            <div class="chat-input-links ms-md-2 me-md-0">
                                <ul class="list-inline mb-0">
                                    <li class="list-inline-item" data-bs-toggle="tooltip" data-bs-placement="top" title="Emoji">
                                        <button type="button" class="btn btn-link text-decoration-none font-size-16 btn-lg waves-effect">
                                            <i class="ri-emotion-happy-line"></i>
                                        </button>
                                    </li>
                                    <li class="list-inline-item" data-bs-toggle="tooltip" data-bs-placement="top" title="Attached File">
                                        <button type="button" class="btn btn-link text-decoration-none font-size-16 btn-lg waves-effect">
                                            <i class="ri-attachment-line"></i>
                                        </button>
                                    </li>
                                    <li class="list-inline-item">
                                        <button type="submit" id="sendBtn" class="btn btn-primary font-size-16 btn-lg chat-send waves-effect waves-light">
                                            <i class="ri-send-plane-2-fill"></i>
                                        </button>
                                    </li>
                                </ul>
                        </div>
                        </div>
                    </div>
                </div>
                <!-- end chat input section -->
            </div>
            <!-- end side chat user-->



        </div>
        <!-- end  layout wrapper -->

        <!-- JAVASCRIPT -->
        <script src="{{ url_for('static', filename='chat/assets/libs/jquery/jquery.min.js') }}"></script>
        <script src="{{ url_for('static', filename='chat/assets/libs/bootstrap/js/bootstrap.bundle.min.js') }}"></script>
        <script src="{{ url_for('static', filename='chat/assets/libs/simplebar/simplebar.min.js') }}"></script>
        <script src="{{ url_for('static', filename='chat/assets/libs/node-waves/waves.min.js') }}"></script>
        <!-- Magnific Popup-->
        <script src="{{ url_for('static', filename='chat/assets/libs/magnific-popup/jquery.magnific-popup.min.js') }}"></script>

        <!-- owl.carousel js -->
        <script src="{{ url_for('static', filename='chat/assets/libs/owl.carousel/owl.carousel.min.js') }}"></script>

        <!-- page init -->
        <script src="{{ url_for('static', filename='chat/assets/js/pages/index.init.js') }}"></script>

        <script src="{{ url_for('static', filename='chat/assets/js/app.js') }}"></script>
        <script type="text/javascript" charset="utf-8">
            $(document).ready(function (){
                var userId = $('#img1').attr('src');

                var socket = io.connect();
                socket.on('connect', function() {
                    socket.send("Connected!", userId);
                });

                socket.on('message', function(data) {
                    $('#messages').append($('<p>').text(data));
                });

                $("#sendBtn").on('click', function () {
                    socket.send($('#message').val(), userId);
                    $('#message').val('');
                });
            });
        </script>

        <script>
            $(document).ready(function () {
                if (window.matchMedia('(max-width: 768px)').matches) {
                    $('#sidepiece').show();
                };
            });
        </script>
    </body>
</html>
